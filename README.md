# CodeCraft2024
- 我们需要更加大胆和更富想象力的策略。
- 复赛正式赛的地图泊位运输时间较长，没有对这一点做专门的优化。优化之后效果明显。线下图1：93380；图2：97021。
- 不应该在关键的时刻过于兴奋以至于失去冷静。

## 策略简介
- 买货策略（复赛）
  1. 基本就是先买8个机器人和1条船，然后在剩余时间，再买一定数量的船和机器人（这里的一定数量是超参数，需要调出来）。
  2. 如果在后续中，观察到船运货的效率大于机器人运货的效率，则再优先买机器人。
  3. 否则，则再优先买船。
- 机器人寻找货物的策略（初赛 + 复赛）
  1. 基本策略，对于每一个刚放下货物，或当前帧没有货物目标的机器人，用贪心策略选货，即通过搜索一定范围内的货物（超参数，设为```extraSearchTime```，意为第一次在BFS算法中找到货物后，再额外搜索的距离（与第一次搜索到的货物在BFS最短路径中的距离），计算它们的性价比（金额 / 机器人从出发运货，到把货物运到目泊位的距离），谁的性价比高，就选谁作为目标。
  2. 细节
      1. 地图上全体货物信息的维护
         对货物信息的维护的要求是：
         - 能通过坐标(x, y)以O(1)的时间复杂度获得货物的价值和剩余存在时间，```int goodsInMap[MAP_SIZE][MAP_SIZE]```矩阵和```int goodsLeftTime[MAP_SIZE][MAP_SIZE]```矩阵；
         - 能以较短时间遍历地图上全体货物的信息，且能通过该信息，在每一帧维护货物的剩余存在时间，以便更新goodsInMap和goodsLeftTime。因此需要：<br>
           ~~~C++
           vector<std::unordered_map<int, int>> goodsInfo; // 存储全体货物在地图中的位置和剩余时间信息，两个维度，第一个维度表示货物出现的时刻（对1000取模），第二个维度是一个```unordered_map```，键为货物的位置，值为货物的剩余存在时间
           ~~~
         因此，在每一帧，先清除掉当前时刻对应的在goodsInfo中的货物信息：
         ~~~C++
         int frameModIdx = (frameId - 1) % 1000;
         goodsInfo[frameModIdx].clear(); // 先把对应时刻的全部货物信息清空
         ~~~
         之后再根据判题器，把新的货物信息加入到goodsInfo中。进一步的维护细节见```void DecisionMaker::updateGoodsInfo()```。
      2. 分区策略
         分区策略是让机器人选货物的时候，更加偏向于自己所在的泊位区域上的货物（这些货物到这个泊位的距离最近）。初见，完全依赖于性价比来决定运货目标就可能在每一步中的局部最优来逼近全局最优。但是，机器人在选货物的那一刻，往往会在泊位上，如果对于某一件货物，它距离某一泊位最近，那么此刻在对应泊位（本区）上的机器人，相对于该货物也最近，它来运这个货物是最高效的。而如果在当前时刻，机器人跨区选择了货物，就会多走了距离，而这个货物，也迟早会被它所在的区域的机器人运走。
      3. 动态更改选货目标策略
         动态更改选货目标策略的出发点是，由于货物生成的时空和价值不确定性，有时候可能会出现无论机器人当前怎么选择，都只能选到低性价比的货物，之后在机器人在确定好并奔赴选货目标的期间，却有高性价比的货物生成的情况。这时候机器人应该放弃当前目标，转而奔赴高性价比的货物。<br>
         $\qquad$然而，此时机器人很可能会多走一段路。如果使用动态更改选货目标策略，就需要抑制机器人动态更改目标。具体方法是，只有机器人预期要运送的货物的性价比过小，且机器人是跨区域来的，且新的货物的性价比要高出预期要运送的货物的性价比一定程度时，才会选择更改运货目标。
      4. 召唤策略
         召唤策略是，如果某个泊位对应的最邻近区域上的货物总金额与在这个区域上服务的机器人数量的比值要远大于其邻近的泊位时，邻近泊位就会发出召唤，让邻区的机器人尽可能过来为自己服务。这个想法的出发点是，
      6. 依据船与机器人的运货效率比较，调整```extraSearchTime```超参数
      7. 快要结束时船与机器人的策略
         详见```berth[i].isBlocked```起作用的对应部分的代码。
- 船运货策略（初赛 + 复赛）
  1. 初赛策略
  2. 复赛策略
- 机器人之间与船之间的避让策略（初赛 + 复赛）
- 其它
  1. 高效BFS
  2. 三维BFS
